<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>Backgammon</title>
    <style>
      :root {
        --clr-bg: #0e0e11;
        --clr-card: rgba(255, 255, 255, 0.05);
        --clr-track: rgba(255, 255, 255, 0.15);
        --clr-fill-start: #23d5ab;
        --clr-fill-end: #3b82f6;
        --radius-lg: 18px;
        --radius-sm: 10px;
        --shadow-elev: 0 10px 28px rgba(0, 0, 0, 0.55);
        --font-base: "Inter", Arial, sans-serif;
      }
      html,
      body {
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: var(--clr-bg);
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: var(--font-base);
      }
      #unity-container {
        position: relative;
      }
      #unity-canvas {
        display: block;
        width: 100%;
        height: 100%;
      }
      #loader-overlay {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        pointer-events: none;
        z-index: 10;
      }
      #loader-card {
        background: var(--clr-card);
        backdrop-filter: blur(10px);
        box-shadow: var(--shadow-elev);
        border-radius: var(--radius-lg);
        padding: 32px;
        display: flex;
        flex-direction: column;
        gap: 16px;
        text-align: center;
        max-width: 90vw;
        width: 360px;
        align-items: center;
      }
      #loader-logo {
        width: 120px;
        height: auto;
        object-fit: contain;
        margin-bottom: 16px; /* space below logo */
      }
      #progress-track {
        width: 100%;
        height: 20px;
        background: var(--clr-track);
        border-radius: var(--radius-sm);
        overflow: hidden;
      }
      #progress-fill {
        width: 0%;
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--clr-fill-start),
          var(--clr-fill-end)
        );
        transition: width 0.1s;
      }
      #progress-track .progress-label {
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        text-align: center;
        line-height: 20px;
        font-size: 0.85rem;
        color: #fff;
        pointer-events: none;
      }
      #bytes {
        font-size: 0.75rem;
        opacity: 0.8;
      }
      #portrait-warning {
        position: absolute;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: var(--clr-bg);
        font-size: 4vw;
        text-align: center;
        padding: 1em;
      }
      #portrait-warning.active {
        display: flex;
      }
    </style>
  </head>
  <body>
    <div id="unity-container">
      <canvas id="unity-canvas" tabindex="1"></canvas>
      <div id="loader-overlay">
        <div id="loader-card">
          <img id="loader-logo" src="TemplateData/logo.png" alt="logo" />
          <div id="bytes">Loading...</div>
          <div id="progress-track">
            <div id="progress-fill">
              <div class="progress-label">0%</div>
            </div>
          </div>
        </div>
      </div>
      <div id="portrait-warning">Please rotate your device to landscape</div>
    </div>
    <script src="loader.js"></script>
    <script>
      const ASPECT = 9 / 6;
      const container = document.getElementById("unity-container");
      const canvas = document.getElementById("unity-canvas");
      const overlay = document.getElementById("loader-overlay");
      const fillEl = document.getElementById("progress-fill");
      const percentEl = document.querySelector(
        "#progress-track .progress-label"
      );
      const bytesEl = document.getElementById("bytes");
      const warnEl = document.getElementById("portrait-warning");

      function isMobile() {
        return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
      }
      function resizeCanvas() {
        if (!isMobile()) {
          const w = window.innerWidth;
          const h = window.innerHeight;
          let cw = w,
            ch = w / ASPECT;
          if (ch > h) {
            ch = h;
            cw = h * ASPECT;
          }
          container.style.width = cw + "px";
          container.style.height = ch + "px";
          canvas.width = cw;
          canvas.height = ch;
        }
      }
      function updateOrientation() {
        if (
          isMobile() &&
          window.matchMedia("(orientation: portrait)").matches
        ) {
          warnEl.classList.add("active");
        } else {
          warnEl.classList.remove("active");
          resizeCanvas();
        }
      }
      window.addEventListener("resize", updateOrientation);
      window.addEventListener("orientationchange", updateOrientation);
      updateOrientation();

      // Unity loader callback
      function onProgress(fraction, loadedBytes, totalBytes) {
        console.log(
          `Loading progress: ${Math.round(
            fraction * 100
          )}% (${loadedBytes} / ${totalBytes} bytes)`
        );
        const pct = Math.round(fraction * 100);
        fillEl.style.width = pct + "%";
        percentEl.textContent = pct + "%";
        if (
          loadedBytes !== undefined &&
          totalBytes != undefined &&
          totalBytes > 0
        ) {
          bytesEl.textContent =
            (loadedBytes / 1048576).toFixed(1) +
            " / " +
            (totalBytes / 1048576).toFixed(1) +
            " MB";
        } else {
          bytesEl.textContent = "Loading...";
        }
      }

      // Start Unity
      createUnityInstance(
        canvas,
        {
          dataUrl: "Build/6032ee12389ec25f88bc8ca111c4ff8e.data.br",
          frameworkUrl: "Build/75a5de9c3908e7a1efe3e74bad1de540.framework.js.br",
          codeUrl: "Build/3d1809979230eb5f47483f48737c6351.wasm.br",
          companyName: "ZeroPlay",
          productName: "Backgammon",
          productVersion: "4.0",
          streamingAssetsUrl: "StreamingAssets",
        },
        onProgress
      )
        .then(() => {
          overlay.style.display = "none";
        })
        .catch((err) => {
          console.error(err);
          alert("Failed to load Unity: " + err.message);
        });
    </script>
  </body>
</html>
