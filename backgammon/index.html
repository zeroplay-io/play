<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>Backgammon</title>
    <style>
      :root {
        --clr-bg: #0e0e11;
        --clr-card: rgba(255, 255, 255, 0.05);
        --clr-track: rgba(255, 255, 255, 0.15);
        --clr-fill-start: #23d5ab;
        --clr-fill-end: #3b82f6;
        --radius-lg: 18px;
        --radius-sm: 10px;
        --shadow-elev: 0 10px 28px rgba(0, 0, 0, 0.55);
        --font-base: "Inter", "Helvetica Neue", Arial, sans-serif;
      }

      html,
      body {
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: var(--clr-bg);
        font-family: var(--font-base);
        color: #fff;
        -webkit-font-smoothing: antialiased;
      }
      #unity-container {
        position: relative;
        width: 100%;
        height: 100%;
      }
      #unity-canvas {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        background: transparent;
      }

      /* ---------- Loader ---------- */
      #loader-overlay {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        pointer-events: none;
      }
      #loader-bg {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: blur(6px) brightness(0.45);
      }
      #loader-card {
        position: relative;
        width: min(90vw, 480px);
        padding: 40px 32px;
        background: var(--clr-card);
        border-radius: var(--radius-lg);
        backdrop-filter: blur(10px);
        box-shadow: var(--shadow-elev);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 28px;
      }
      #loader-logo {
        width: 160px;
        height: auto;
        object-fit: contain;
      }
      #progress-track {
        width: 100%;
        height: 26px;
        background: var(--clr-track);
        border-radius: var(--radius-sm);
        overflow: hidden;
      }
      #progress-fill {
        width: 0%;
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--clr-fill-start),
          var(--clr-fill-end)
        );
      }
      #percent {
        font-size: 1.05rem;
        letter-spacing: 0.5px;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
      }
      #bytes {
        font-size: 0.85rem;
        opacity: 0.8;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
      }

      /* ---------- Orientation ---------- */
      #portrait-warning {
        position: absolute;
        inset: 0;
        background: var(--clr-bg);
        display: none;
        align-items: center;
        justify-content: center;
        text-align: center;
        font-size: 5vw;
        z-index: 9999;
      }
      #portrait-warning.active {
        display: flex;
      }

      @media (max-width: 420px) {
        #loader-card {
          padding: 32px 24px;
          gap: 20px;
        }
        #progress-track {
          height: 22px;
        }
        #percent {
          font-size: 0.95rem;
        }
      }
    </style>
  </head>
  <body>
    <div id="unity-container">
      <div id="loader-overlay">
        <img id="loader-bg" src="TemplateData/bg.jpg" alt="background" />
        <div id="loader-card">
          <img id="loader-logo" src="TemplateData/logo.png" alt="logo" />
          <div id="progress-track"><div id="progress-fill"></div></div>
          <div id="percent">0%</div>
          <div id="bytes">0 / 0 MB</div>
        </div>
      </div>
      <div id="portrait-warning">Please rotate your device to landscape</div>
      <canvas id="unity-canvas" tabindex="1"></canvas>
    </div>

    <script src="Build/4f511168bee26cacca170f9f48e6d337.loader.js"></script>
    <script>
      /* ---------- BUILD META ---------- */
      const buildUrl = "Build";
      const dataFile = "3c26b8be9cfe4f7647dd6654e5eeca35.data.br";
      const frameworkFile = "75a5de9c3908e7a1efe3e74bad1de540.framework.js.br";
      const codeFile = "744b013fe526cd9a33d1c7cf48063e5f.wasm.br";
      const memoryFile = "";
      const symbolsFile = "";
      const buildFiles = [
        dataFile,
        frameworkFile,
        codeFile,
        memoryFile,
        symbolsFile,
      ].filter(Boolean);

      /* ---------- UNITY CONFIG ---------- */
      const config = {
        dataUrl: `${buildUrl}/${dataFile}`,
        frameworkUrl: `${buildUrl}/${frameworkFile}`,
        codeUrl: `${buildUrl}/${codeFile}`,
        streamingAssetsUrl: "StreamingAssets",
        companyName: "ZeroPlay",
        productName: "Backgammon",
        productVersion: "3.3",
        devicePixelRatio: 1,
      };
      if (memoryFile) config.memoryUrl = `${buildUrl}/${memoryFile}`;
      if (symbolsFile) config.symbolsUrl = `${buildUrl}/${symbolsFile}`;

      /* ---------- ORIENTATION (mobile only) ---------- */
      function isMobile() {
        return (
          /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent) ||
          window.matchMedia("(pointer:coarse)").matches
        );
      }
      function updateOrientation() {
        const warn = document.getElementById("portrait-warning");
        const need =
          isMobile() && window.matchMedia("(orientation: portrait)").matches;
        warn.classList[need ? "add" : "remove"]("active");
      }
      window.addEventListener("orientationchange", updateOrientation);
      window.addEventListener("resize", updateOrientation);
      updateOrientation();

      /* ---------- PROGRESS STATE ---------- */
      let totalBytes = 0,
        loadedBytes = 0;
      const fillEl = document.getElementById("progress-fill");
      const percentEl = document.getElementById("percent");
      const bytesEl = document.getElementById("bytes");
      const MB = 1 << 20;
      function updateUI() {
        if (!totalBytes) return;
        const pct = Math.min(100, Math.round((loadedBytes / totalBytes) * 100));
        fillEl.style.width = `${pct}%`;
        percentEl.textContent = `${pct}%`;
        bytesEl.textContent = `${(loadedBytes / MB).toFixed(1)} / ${(
          totalBytes / MB
        ).toFixed(1)} MB`;
      }

      /* ---------- FETCH HELPERS ---------- */
      const originalFetch = window.fetch.bind(window);

      async function calcTotal() {
        const sizes = await Promise.all(
          buildFiles.map(async (f) => {
            try {
              const r = await originalFetch(`${buildUrl}/${f}`, {
                method: "HEAD",
              });
              return +r.headers.get("Content-Length") || 0;
            } catch {
              return 0;
            }
          })
        );
        totalBytes = sizes.reduce((a, b) => a + b, 0);
        updateUI();
      }

      function streamWithProgress(res) {
        if (!res.body || !res.body.getReader) return res;
        const reader = res.body.getReader();
        const stream = new ReadableStream({
          start(controller) {
            (function pump() {
              reader.read().then(({ done, value }) => {
                if (done) {
                  controller.close();
                  return;
                }
                loadedBytes += value.byteLength;
                updateUI();
                controller.enqueue(value);
                pump();
              });
            })();
          },
        });
        return new Response(stream, { headers: res.headers });
      }

      function isBinaryAsset(url) {
        return /\.(wasm|data|mem|symbols)(\.br)?$/i.test(url);
      }

      function fetchProxy(resource, options) {
        const url = typeof resource === "string" ? resource : resource.url;
        const track = url && url.startsWith(buildUrl) && isBinaryAsset(url);
        return track
          ? originalFetch(resource, options).then(streamWithProgress)
          : originalFetch(resource, options);
      }

      /* ---------- BOOTSTRAP ---------- */
      (async () => {
        await calcTotal();
        window.fetch = fetchProxy;
        try {
          await createUnityInstance(
            document.getElementById("unity-canvas"),
            config
          );
          document.getElementById("loader-overlay").style.display = "none";
        } catch (e) {
          alert(e);
        } finally {
          window.fetch = originalFetch;
        }
      })();
    </script>
  </body>
</html>
