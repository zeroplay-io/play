<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <!-- Prevent edge case scrolling in mobile browsers -->
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>Backgammon GO: Fair Dice</title>
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #000;
      }
      /* ##########  LAYOUT  ########## */
      #unity-container {
        position: relative;
        width: 100%;
        height: 100%;
      }
      #unity-canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: transparent;
      }
      /* ##########  LOADING SCREEN  ########## */
      #loading-bg {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        object-fit: cover;
        z-index: 1;
      }

      #loading-bar {
        position: absolute;
        bottom: 10%;
        left: 50%;
        transform: translateX(-50%);
        width: 60vw;
        max-width: 600px;
        height: 24px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        overflow: hidden;
        z-index: 2;
      }
      #loading-fill {
        width: 0%;
        height: 100%;
        background: #4caf50;
      }
      #loading-percent {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        text-align: center;
        line-height: 24px;
        font-family: Arial, sans-serif;
        font-size: 14px;
        color: #fff;
        z-index: 3;
      }

      /* ##########  ORIENTATION OVERLAY  ########## */
      #portrait-warning {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        color: #fff;
        font-family: Arial, sans-serif;
        font-size: 5vw;
        text-align: center;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }
    </style>
  </head>
  <body>
    <div id="unity-container">
      <img id="loading-bg" src="TemplateData/bg.jpg" alt="loading background" />
      <div id="loading-bar">
        <div id="loading-fill"></div>
        <span id="loading-percent">0%</span>
      </div>
      <div id="portrait-warning">Please rotate your device to landscape</div>
      <canvas id="unity-canvas" tabindex="1"></canvas>
    </div>

    <!-- UNITY LOADER -->
    <script src="Build/f96e4f2185d680aec99a3e595d266733.loader.js"></script>
    <script>
      // Detect if we are inside an iframe or standalone
      const inIframe = (() => {
        try {
          return window.self !== window.top;
        } catch (e) {
          return true;
        }
      })();

      // Ensure container resizes with iframe or window
      function resizeCanvas() {
        const canvas = document.getElementById("unity-canvas");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      window.addEventListener("resize", resizeCanvas);

      // Orientation overlay for portrait mode on mobile
      function checkOrientation() {
        const warn = document.getElementById("portrait-warning");
        if (window.matchMedia("(orientation: portrait)").matches) {
          warn.style.display = "flex";
        } else {
          warn.style.display = "none";
        }
      }
      window.addEventListener("orientationchange", checkOrientation);
      checkOrientation();

      // Create Unity instance
      const buildUrl = "Build";
      const config = {
        dataUrl: buildUrl + "/b3e26162766687ce615b56b720d3d66d.data.br",
        frameworkUrl: buildUrl + "/a82eddb7a80ff253ba38498f0b08ac90.framework.js.br",
        codeUrl: buildUrl + "/e9f31681a3739720d3e14d364010a181.wasm.br",
        memoryUrl: buildUrl + "/",
        symbolsUrl: buildUrl + "/",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "ZeroPlay",
        productName: "Backgammon GO: Fair Dice",
        productVersion: "1.6",
        // Disable WASM multithreading to avoid cross-origin-isolated requirement in iframes
        devicePixelRatio: 1,
      };

      const canvas = document.getElementById("unity-canvas");

      function updateProgress(progress) {
        const fill = document.getElementById("loading-fill");
        const text = document.getElementById("loading-percent");
        const pct = Math.round(progress * 100);
        fill.style.width = `${pct}%`;
        text.textContent = `${pct}%`;
      }

      // Call resize once for standalone mode
      if (!inIframe) resizeCanvas();

      createUnityInstance(canvas, config, (progress) => {
        updateProgress(progress);
        if (progress === 1) {
          document.getElementById("loading-bar").style.display = "none";
          document.getElementById("loading-bg").style.display = "none";
        }
      }).catch((message) => alert(message));
    </script>
  </body>
</html>
